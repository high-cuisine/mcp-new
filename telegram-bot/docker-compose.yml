services:
  telegram-userbot:
    build: .
    container_name: telegram-userbot
    restart: on-failure
    stdin_open: true
    tty: true
    # На Linux host.docker.internal по умолчанию нет — добавляем вручную
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - 3507:3507
    environment:
      TELEGRAM_API_ID: "${TELEGRAM_API_ID}"
      TELEGRAM_API_HASH: "${TELEGRAM_API_HASH}"
      TELEGRAM_PHONE_NUMBER: "${TELEGRAM_PHONE_NUMBER}"
      TELEGRAM_SESSION_FILE: "/data/session.txt"
    volumes:
      # Том с сессией: session.txt из корня проекта пробрасывается в контейнер
      - ./session.txt:/data/session.txt
      - ./data:/data
    networks:
      - telegram-network
networks:
  telegram-network:
    name: telegram-network
    driver: bridge
